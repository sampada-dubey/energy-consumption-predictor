<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Energy Consumption Predictor</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <link rel="stylesheet" href="{{ url_for('static', filename='style.css') }}">
  <style>
    input[disabled] {
      background-color: #f0f0f0;
      border: none;
      font-weight: bold;
      color: #333;
    }
  </style>
</head>
<body>
  <div class="container">
    <h2 class="mb-4 text-center">ðŸ”‹ Energy Consumption Predictor</h2>

    <!-- Datetime display -->
    <p id="datetime-label" style="font-weight: bold; color: #444;"></p>

    <form action="/predict" id="predictionForm" method="POST">
      <!-- Manual or Auto Location -->
      <div class="mb-3">
        <label>Enter your location (or allow auto-location):</label>
        <input type="text" id="location" name="location" required><br><br>
      </div>

      <!-- Hidden full time fields -->
      <input type="number" id="minute" name="minute" hidden>
      <input type="number" id="second" name="second" hidden>

      <!-- Hour -->
      <div class="mb-3">
        <label for="hour">Hour (24-hour format):</label>
        <input type="number" class="form-control" id="hour" name="hour" min="0" max="23" required><br>
      </div>

      <!-- Day -->
      <div class="mb-3">
        <label for="day">Day:</label>
        <input type="number" class="form-control" id="day" name="day" min="1" max="31" required><br>
      </div>

      <!-- Month (number + readable name) -->
      <div class="mb-3">
        <label for="month">Month:</label>
        <input type="number" id="month" name="month" min="1" max="12" required hidden>
        <input type="text" id="month_display" disabled><br>
      </div>

      <!-- Day of week -->
      <div class="mb-3">
        <label for="day_of_week">Day of Week:</label>
        <input type="number" id="day_of_week" name="day_of_week" min="0" max="6" required hidden>
        <input type="text" id="day_of_week_display" disabled><br>
      </div>

      <!-- Weekend? -->
      <div class="mb-3">
        <label for="is_weekend">Is it weekend?</label>
        <input type="number" class="form-control" id="is_weekend" name="is_weekend" min="0" max="1" required><br>
      </div>

      <!-- Button -->
      <button type="button" class="btn btn-primary w-100" onclick="getLocationAndSubmit()" style="font-size: 18px; color: #333; padding: 10px;">
        <strong>
          Predict Energy Consumption</button><br><br><span id="prediction"></span>
        </strong>
    </form>

  <script>
    window.onload = function () {
      const now = new Date();

      const monthNames = ["January", "February", "March", "April", "May", "June",
                          "July", "August", "September", "October", "November", "December"];
      const dayNames = ["Monday", "Tuesday", "Wednesday", "Thursday", "Friday", "Saturday", "Sunday"];

      const hour = now.getHours();
      const minute = now.getMinutes();
      const second = now.getSeconds();
      const date = now.getDate();
      const month = now.getMonth(); // 0-based
      const jsDay = now.getDay(); // 0 = Sunday
      const dayOfWeek = jsDay === 0 ? 6 : jsDay - 1;

      // Fill form values
      document.getElementById('hour').value = hour;
      document.getElementById('minute').value = minute;
      document.getElementById('second').value = second;
      document.getElementById('day').value = date;
      document.getElementById('month').value = month + 1;
      document.getElementById('day_of_week').value = dayOfWeek;
      document.getElementById('is_weekend').value = (dayOfWeek >= 5) ? 1 : 0;

      // Display readable versions
      document.getElementById('month_display').value = monthNames[month];
      document.getElementById('day_of_week_display').value = dayNames[dayOfWeek];
      document.getElementById('datetime-label').innerText =
        `ðŸ•’ Current Time: ${hour}:${minute}:${second} â€” ${dayNames[dayOfWeek]}, ${date} ${monthNames[month]}`;
    };

    function getLocationAndSubmit() {
      if (navigator.geolocation) {
        navigator.geolocation.getCurrentPosition(function(position) {
          const lat = position.coords.latitude;
          const lon = position.coords.longitude;

          fetch(`https://nominatim.openstreetmap.org/reverse?lat=${lat}&lon=${lon}&format=json`)
            .then(response => response.json())
            .then(data => {
              const inputLocation = document.getElementById('location').value;
              if (!inputLocation) {
                document.getElementById('location').value = data.address.city || data.address.town || "Delhi";
              }
              document.getElementById('predictionForm').submit();
            });
        });
      } else {
        alert("Geolocation not supported.");
      }
    }
  </script>
</body>
</html>
